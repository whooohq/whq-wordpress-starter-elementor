!function(f){jQuery(document).ready(function(){var m=f("#gform-settings"),e=f(".gfga-disconnect"),d=(0<e.length&&e.on("click",function(a){a.preventDefault(),e.html(google_analytics_admin_strings.disconnect);a=wpAjax.unserialize(a.target.href).nonce;f.post(ajaxurl,{action:"disconnect_account",nonce:a},function(a){window.location.href=window.location.href})}),m.find('input[name="gfgaaction"]'));0!==d.length&&m.find(":submit").prop("disabled",!0),f("#gform-settings-section-google-analytics-settings").on("change","input, select",function(a){var e=m.find('select[name="gaproperty"]').find(":selected").val(),n=f("#ga-views select :selected").val(),t=(f("input[name=_gform_setting_gamanual]").val(),f("#ga_ua_code").val()),i=f("#ga_account_id").val(),o=f("#ga_view").val(),c=m.find('select[name="gtmproperty"]').find(":selected").val(),s=(c=c||m.find("#container").val(),m.find('select[name="gaworkspace"]').val()),g=(s=s||m.find("#workspace").val(),m.find(":submit"));"ga"===d.val()&&("self_config"==e&&t&&i&&o||"manual"==e||e&&n?g.prop("disabled",!1):g.prop("disabled",!0)),"gtm"===d.val()&&("manual"===e&&c&&s||e&&n&&c&&s?g.prop("disabled",!1):g.prop("disabled",!0))}),m.on("submit",function(a){var e,n,t,i,o,c,s,g,d,l,_,r;1==m.find('input[value="google_analytics_setup"]').length?(a.preventDefault(),d=m.find("#gform-settings-save"),e=m.find('[name="_gform_setting_mode"]:checked').val(),d.prop("value",google_analytics_admin_strings.redirect).prop("disabled","disabled"),d=m.find('input[name="gfganonce"]').val(),f.post(ajaxurl,{action:"redirect_to_api",nonce:d,mode:e},function(a){a.data.errors||(window.location.href=a.data.redirect)},"json")):0!=(d=m.find('input[name="gfgaaction"]')).length&&(e=m.find('input[name="gfganonce"]').val(),n=m.find('input[name="gfga_token"]').val(),t=m.find('input[name="gfga_refresh"]').val(),"ga"===d.val()&&(a.preventDefault(),m.find(":submit").val(google_analytics_admin_strings.connecting).prop("disabled","disabled"),g="self_config"==(_=m.find('select[name="gaproperty"]')).val()?(i=f("#ga_ua_code").val(),o=f("#ga_account_id").val(),c=f("#ga_account_name").val(),s=f("#ga_view").val(),f("#ga_view_name").val()):(i=_.val(),o=_.find(":selected").data("account-id"),c=_.find(":selected").data("account-name"),s=f("#ga-views select :selected").val(),f("#ga-views select :selected").data("view-name")),f.post(ajaxurl,{action:"save_google_analytics_data",nonce:e,token:n,refresh:t,account_id:o,account_name:c,ga_code:i,view:s,view_name:g},function(a){window.location.href=a})),"gtm"===d.val())&&(a.preventDefault(),m.find(":submit").val(google_analytics_admin_strings.connecting).prop("disabled","disabled"),i=(_=m.find('select[name="gaproperty"]')).val(),_.find(":selected").val(),o=_.find(":selected").data("account-id"),c=_.find(":selected").data("account-name"),s=f("#ga-views select :selected").val(),g=f("#ga-views select :selected").data("view-name"),d=m.find('select[name="gtmproperty"]').find(":selected").data("account-id"),l=(a=m.find('select[name="gacontainer"]')).find(":selected").data("path"),a=(a=a.find(":selected").val())||m.find("#container").val(),l=l||"accounts/"+d+"/containers/"+m.find("#container_id").val(),_=(_=(_=m.find('select[name="gaworkspace"]')).val())||m.find("#workspace").val(),r=1==(r=m.find('input[name="_gform_setting_gtm_auto_create"]')).val()?"on":r.val(),f.post(ajaxurl,{action:"save_google_tag_manager_data",nonce:e,token:n,refresh:t,account_id:o,account_name:c,ga_code:i,gtm_account_id:d,gtm_path:l,gtm_container:a,gtm_auto_create:r,gtm_workspace:_,view:s,view_name:g},function(a){!1===a.success?(f("#gform-page-loader-mask").hide(),f("#gform-settings").before('<div class="alert gforms_note_error" role="alert">'+a.data[0].message+"</div>"),f(".alert").get(0).scrollIntoView(),f("#gform_setting_container_id, #gform_setting_workspace, #gform_setting_container").find(".gform-settings-input__container").addClass("gform-settings-input__container--invalid")):window.location.href=a}))}),f("#gaproperty").on("change",function(a){var e,n,t,i=f(this).find(":selected");"self_config"===i.val()?f("#gform_setting_ga_ua_code, #gform_setting_ga_account_id, #gform_setting_ga_account_name, #gform_setting_ga_view, #gform_setting_ga_view_name, #gform_setting_manual_instructions").show():f("#gform_setting_ga_ua_code, #gform_setting_ga_account_id, #gform_setting_ga_account_name, #gform_setting_ga_view, #gform_setting_ga_view_name, #gform_setting_manual_instructions").hide(),"manual"===i.val()?f("#ga-views").html(""):(e=i.data("ua-code"),n=i.data("account-id"),i=i.data("token"),t=f("body").find('input[name="gfganonce"]').val(),f("#ga-views").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),f.post(ajaxurl,{action:"get_ga_views",account_id:n,ga_code:e,nonce:t,token:i},function(a){f("#ga-views").html(a)}))}),f("#gtmproperty").on("change",function(a){var e=f(this).find(":selected"),n=e.data("accountId"),t=e.data("path"),e=e.data("token"),i=f("body").find('input[name="gfganonce"]').val();f("#gtm-containers").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),f.post(ajaxurl,{action:"get_gtm_containers",accountId:n,path:t,nonce:i,token:e},function(a){a.success?f("#gtm-containers").html(a.body):(f("#gform_setting_container").show(),f("#gform_setting_container_id").show(),f("#gform_setting_workspace").show(),f("#gtm-containers").hide())})}),f(document).on("change","#gacontainer",function(a){var e=f(this).find(":selected"),n=e.data("path"),e=e.data("token"),t=f("body").find('input[name="gfganonce"]').val();f("#gtm-workspaces").html('<br /><img src="'+google_analytics_admin_strings.spinner+'" />'),f.post(ajaxurl,{action:"get_gtm_workspaces",path:n,nonce:t,token:e},function(a){a.success?f("#gtm-workspaces").html(a.body):(f("#gform_setting_workspace").show(),f("#gtm-workspaces").hide())})})})}((window.GF_Google_Analytics_Admin=window.GF_Google_Analytics_Admin||{},jQuery));