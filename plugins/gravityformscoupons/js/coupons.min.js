function ApplyCouponCode(c){var o=jQuery("#gf_coupon_code_"+c).val();"undefined"!==o&&""!=o&&(jQuery("#gf_coupons_container_"+c+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+c+" #gf_coupon_button").prop("disabled",!0),jQuery.post(gform_coupon_script_strings.ajaxurl,{action:"gf_apply_coupon_code",couponCode:o,existing_coupons:jQuery("#gf_coupon_codes_"+c).val(),formId:c,total:jQuery("#gf_total_no_discount_"+c).val()},function(o){var n=jQuery.parseJSON(o);if(jQuery("#gf_coupons_container_"+c+" .gf_coupon_invalid").remove(),jQuery("#gf_coupon_code_"+c).val(""),n.is_valid){window["gf_coupons"+c]=n.coupons;var _,e="",u=0;for(_ in window["gf_coupons"+c])0<u&&(e+=","),e+=window["gf_coupons"+c][_].code,u++;jQuery("#gf_coupon_codes_"+c).val(e).change(),jQuery("#gf_coupons_"+c).val(jQuery.toJSON(window["gf_coupons"+c])),gformCalculateTotalPrice(c)}else jQuery("#gf_coupons_container_"+c+" #gf_coupon_info").prepend("<div class='gf_coupon_invalid'><span>"+n.invalid_reason+"</span></div>");jQuery("#gf_coupons_container_"+c+" #gf_coupon_spinner").hide()}))}function GetDiscount(o,n,_,e){var u;return _-=e,u="flat"==o?Number(n):_*Number(n/100),gform.applyFilters("gform_coupons_discount_amount",u,o,n,_,e)}function PopulateDiscountInfo(o,n){var _,e,u,c="",r=0,i=new Currency(gf_global.gf_currency_config);for(_ in void 0===window["gf_coupons"+n]&&(window["gf_coupons"+n]=jQuery.evalJSON(jQuery("#gf_coupons_"+n).val())),window["gf_coupons"+n])r+=u=GetDiscount((e=window["gf_coupons"+n][_]).type,e.amount,o,r),c+='<tr class="gf_coupon_item" id="gf_coupon_'+e.code.replace(/[^A-Za-z0-9]/g,"")+'"><td class="gf_coupon_name_container">   <a href="javascript:void(0);" onclick="DeleteCoupon(\''+e.code+"' , '"+n+'\');">(x)</a>   <span class="gf_coupon_name">'+e.name+'</span></td><td class="gf_coupon_discount_container">   <span class="gf_coupon_discount">-'+i.toMoney(u,!0)+"</span></td></tr>";return jQuery("#gf_coupons_container_"+n+" #gf_coupon_info").html("<table>"+c+"</table>"),r}function DisableApplyButton(o){0==window["new_total_"+o]||""==jQuery("#gf_coupon_code_"+o).val()?jQuery("#gf_coupons_container_"+o+" #gf_coupon_button").prop("disabled",!0):jQuery("#gf_coupons_container_"+o+" #gf_coupon_button").prop("disabled",!1)}function DeleteCoupon(o,n){if(!jQuery("#gf_coupons_container_"+n+" #gf_coupon_spinner").is(":visible")){var _=o.replace(/[^A-Za-z0-9]/g,"");jQuery("#gf_coupons_container_"+n+" #gf_coupon_"+_).remove(),jQuery("#gf_coupons_container_"+n+" #gf_coupon_spinner").show(),jQuery("#gf_coupons_container_"+n+" #gf_coupon_button").prop("disabled",!0);var e=jQuery("#gf_coupon_codes_"+n),u=e.val().split(","),c=jQuery.inArray(o,u);-1!=c&&(u.splice(c,1),e.val(u.join(",")).change(),o in window["gf_coupons"+n]&&(delete window["gf_coupons"+n][o],jQuery("#gf_coupons_"+n).val(jQuery.toJSON(window["gf_coupons"+n]))),gformCalculateTotalPrice(n),gform.doAction("gform_coupons_post_delete_coupon",o,n))}}gform.addFilter("gform_product_total",function(o,n){if(0==jQuery("#gf_coupon_code_"+n).length)return o;jQuery("#gf_total_no_discount_"+n).val(o);var _=o;if(""!=(gformIsHidden(jQuery("#gf_coupon_code_"+n))?"":jQuery("#gf_coupon_codes_"+n).val())||""!=jQuery("#gf_coupons_"+n).val()){var e=PopulateDiscountInfo(o,n);(_=o-gformRoundPrice(e))<0&&(_=0)}return jQuery("#gf_coupons_container_"+n+" #gf_coupon_spinner").hide(),window["new_total_"+n]=_,DisableApplyButton(n),_},50),gform.addFilter("gform_is_value_match",function(o,n,_){var e=jQuery("#field_"+n+"_"+_.fieldId).find("#gf_coupon_codes_"+n);return e.length?gf_matches_operation(e.val(),_.value,_.operator):o}),gform.addAction("gform_post_conditional_logic_field_action",function(o,n,_,e,u){if(!u&&"hide"==n){var c=jQuery(_),r=c.find("tr.gf_coupon_item");r.length&&(r.remove(),c.find("input[type=hidden]").val("").change())}}),gform.addFilter("gform_field_meta_raw_input_change",function(o,n,_){return n.attr("id")&&0===n.attr("id").indexOf("gf_coupon_codes_")&&(o.fieldId=n.attr("name").split("_")[1],o.formId=n.attr("id").split("_")[3]),o});