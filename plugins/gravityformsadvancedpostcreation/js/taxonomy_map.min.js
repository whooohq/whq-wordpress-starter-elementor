var GFTaxonomyMap=function(e){var r=this;return r.options=e,r.UI=jQuery("#gform_setting_"+r.options.fieldName),r.init=function(){r.options.formFields=JSON.parse(r.options.formFields),r.options.preloadedTerms=JSON.parse(r.options.preloadedTerms),r.bindEvents(),r.setupData(),r.setupRepeater()},r.bindEvents=function(){r.UI.on("change",'select[name="_gform_setting_'+r.options.keyFieldName+'"]',function(){r.setupRow(jQuery(this).closest("tr"),{})}),r.UI.closest("form").on("submit",function(e){jQuery('[name^="_gform_setting_'+r.options.fieldName+'_"]').each(function(e){jQuery(this).removeAttr("name")})})},r.setupData=function(){var e=jQuery("#"+r.options.fieldId).val();r.data=e?jQuery.parseJSON(e):null,r.data||(r.data=[{key:"",value:"",custom_value:""}])},r.setupRow=function(e,o){var t=e.find('select[name="_gform_setting_'+r.options.keyFieldName+'"]'),a=e.find('select[name="_gform_setting_'+r.options.valueFieldName+'"]'),n=a.closest("tr").find(".custom-value-container");t.select2({minimumResultsForSearch:1/0});t.siblings(".select2-container");var s=a.data("select2")?a.siblings(".select2-container"):a;if("gf_custom"===t.val()||"gf_custom"===o.value)s.hide(),n.show();else switch(n.hide(),a.data("select2")&&a.select2("destroy"),a.find("option").each(function(){0!=this.value.length&&jQuery(this).remove()}),t.val()){case"field":a.removeAttr("disabled");var i="";jQuery.each(r.options.formFields,function(e,t){"category"!==r.options.taxonomy&&"post_category"===t.type||(a.append(jQuery("<option>",{value:t.value,text:t.label})),o.value==t.value&&(i=o.value))}),0<i.length&&a.val(i),a.select2();break;case"term":a.removeAttr("disabled"),r.options.preloadedTerms[o.value]&&(a.append(jQuery("<option>",{value:o.value,text:r.options.preloadedTerms[o.value]})),a.val(o.value)),a.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"gform_advancedpostcreation_taxonomy_search",nonce:gform_advancedpostcreation_form_settings_strings.nonce_search,taxonomy:r.options.taxonomy,query:e.term}}}}),a.on("select2:selecting",function(e){var t=e.params.args.data;"gf_custom"===t.id&&(a.select2("destroy").hide(),n.show()),r.options.preloadedTerms[t.id]||(r.options.preloadedTerms[t.id]=t.text)});break;default:a.attr("disabled","disabled"),a.select2()}},r.setupRepeater=function(){var e=0<r.options.limit?r.options.limit:0;r.UI.find("tbody.repeater").repeater({limit:e,items:r.data,addButtonMarkup:'<button class="add_field_choice gform-st-icon gform-st-icon--circle-plus gform-settings-generic-map__button gform-settings-generic-map__button--add"><span class="screen-reader-text">Add</span></button>',removeButtonMarkup:'<button class="delete_field_choice gform-st-icon gform-st-icon--circle-minus gform-settings-generic-map__button gform-settings-generic-map__button--delete"><span class="screen-reader-text">Delete</span></button>',callbacks:{add:function(e,t,o){r.setupRow(t,o)},save:function(e,t){jQuery("#"+r.options.fieldId).val(JSON.stringify(t))}}})},r.init()};