var GFTaxonomyMap=function(e){var r=this;return r.options=e,r.UI=jQuery("#gaddon-setting-row-"+r.options.fieldName),r.init=function(){r.options.formFields=JSON.parse(r.options.formFields),r.options.preloadedTerms=JSON.parse(r.options.preloadedTerms),r.bindEvents(),r.setupData(),r.setupRepeater()},r.bindEvents=function(){r.UI.on("change",'select[name="_gaddon_setting_'+r.options.keyFieldName+'"]',function(){r.setupRow(jQuery(this).parent().parent(),{})}),r.UI.closest("form").on("submit",function(e){jQuery('[name^="_gaddon_setting_'+r.options.fieldName+'_"]').each(function(e){jQuery(this).removeAttr("name")})})},r.setupData=function(){var e=jQuery("#"+r.options.fieldId).val();r.data=e?jQuery.parseJSON(e):null,r.data||(r.data=[{key:"",value:"",custom_value:""}])},r.setupRow=function(e,a){var t=e.find('select[name="_gaddon_setting_'+r.options.keyFieldName+'"]'),o=e.find('select[name="_gaddon_setting_'+r.options.valueFieldName+'"]'),n=o.siblings(".custom-value-container");t.select2({minimumResultsForSearch:1/0});t.siblings(".select2-container");var s=o.data("select2")?o.siblings(".select2-container"):o;if("gf_custom"===t.val()||"gf_custom"===a.value)s.hide(),n.show();else switch(n.hide(),o.data("select2")&&o.select2("destroy"),o.find("option").each(function(){0!=this.value.length&&jQuery(this).remove()}),t.val()){case"field":o.removeAttr("disabled");var i="";jQuery.each(r.options.formFields,function(e,t){"category"!==r.options.taxonomy&&"post_category"===t.type||(o.append(jQuery("<option>",{value:t.value,text:t.label})),a.value==t.value&&(i=a.value))}),0<i.length&&o.val(i),o.select2();break;case"term":o.removeAttr("disabled"),r.options.preloadedTerms[a.value]&&(o.append(jQuery("<option>",{value:a.value,text:r.options.preloadedTerms[a.value]})),o.val(a.value)),o.select2({ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"gform_advancedpostcreation_taxonomy_search",nonce:gform_advancedpostcreation_form_settings_strings.nonce_search,taxonomy:r.options.taxonomy,query:e.term}}}}),o.on("select2:selecting",function(e){var t=e.params.args.data;"gf_custom"===t.id&&(o.select2("destroy").hide(),n.show()),r.options.preloadedTerms[t.id]||(r.options.preloadedTerms[t.id]=t.text)});break;default:o.attr("disabled","disabled"),o.select2()}},r.setupRepeater=function(){var e=0<r.options.limit?r.options.limit:0;r.UI.find("tbody.repeater").repeater({limit:e,items:r.data,addButtonMarkup:'<i class="gficon-add"></i>',removeButtonMarkup:'<i class="gficon-subtract"></i>',callbacks:{add:function(e,t,a){r.setupRow(t,a)},save:function(e,t){jQuery("#"+r.options.fieldId).val(JSON.stringify(t))}}})},r.init()};