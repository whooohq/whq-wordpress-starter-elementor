'use strict';window.tsfTitle=function(){const a="undefined"!=typeof tsfTitleL10n&&tsfTitleL10n,b=tsf.escapeString(a.params.untitledTitle),c=tsf.escapeString(a.i18n.protectedTitle),d=tsf.escapeString(a.i18n.privateTitle),e=!!a.params.stripTitleTags,f=new Map,g={},h=new Map,i=new Map,j=a=>h.get(a)||"",k=a=>i.get(a)||"",l=(a,b)=>h.set(a,b)&&j(a),m=(a,b)=>i.set(a,b)&&k(a),n=a=>document.getElementById(`tsf-title-placeholder-prefix_${a}`)||document.createElement("span"),o=a=>document.getElementById(`tsf-title-placeholder-additions_${a}`)||document.createElement("span"),p=a=>f.get(a),q=(a,b)=>b?g[a]?.[b]:g[a],r=(a,b,c)=>{if(g[a][b]!==c)switch(g[a][b]=c,b){case"showPrefix":case"prefixValue":case"prefixPlacement":w(a),G(a);break;case"addAdditions":case"separator":case"additionValue":case"additionPlacement":v(a),G(a);break;case"allowReferenceChange":case"defaultTitle":default:G(a);}},s=a=>{let b=[document.getElementById(`tsf-title-reference_${a}`)];if(q(a,"hasLegacy")){let a=document.getElementById("tsf-title-reference");a&&b.unshift(a)}return b},t=a=>[document.getElementById(`tsf-title-noadditions-reference_${a}`)],u=a=>{const b=s(a.target.id),c=t(a.target.id);if(!b[0]||!c[0])return;const d=q(a.target.id,"allowReferenceChange");let e=d&&a.target.value.trim()||q(a.target.id,"defaultTitle")||"",f=e;if(e.length&&d){let b=k(a.target.id),c=j(a.target.id);if(b.length&&q(a.target.id,"showPrefix")){switch(q(a.target.id,"prefixPlacement")){case"before":window.isRtl?e+=b:e=b+e;break;case"after":window.isRtl?e=b+e:e+=b;}f=e}if(c.length)switch(q(a.target.id,"additionPlacement")){case"before":e=c+e;break;case"after":e+=c;}}const g=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(e).trim())))),h=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(tsf.sTabs(tsf.sSingleLine(f).trim())))),i=new Event("change");b.forEach(a=>{a.innerHTML=g,setTimeout(()=>{a.dispatchEvent(i)},0)}),c.forEach(a=>{a.innerHTML=h,setTimeout(()=>{a.dispatchEvent(i)},0)})},v=a=>{let b="",c="",d="";if(q(a,"addAdditions")&&(c=tsf.escapeString(tsf.decodeEntities(q(a,"additionValue"))),d=q(a,"separator")),c)switch(q(a,"additionPlacement")){case"before":b=`${c} ${d} `;break;case"after":b=` ${d} ${c}`;}o(a).innerHTML=l(a,b||"")},w=a=>{let b="",c=q(a,"showPrefix"),d=q(a,"prefixValue");if(c&&d)switch(q(a,"prefixPlacement")){case"before":b=window.isRtl?` ${d}`:`${d} `;break;case"after":b=window.isRtl?`${d} `:` ${d}`;}n(a).innerHTML=m(a,b||"")},x=a=>{let b=o(a.target.id),c=n(a.target.id);if(!b&&!c)return;const d=a.target,e=a.target.value,f=k(a.target.id).length&&q(a.target.id,"showPrefix"),g=!!j(a.target.id).length;if(!f&&c&&(c.style.display="none"),!g&&b&&(b.style.display="none"),!f&&!g)return void(d.style.textIndent="initial");if(!e.length)return d.style.textIndent="initial",c&&(c.style.display="none"),void(b&&(b.style.display="none"));const h=getComputedStyle(d),i=d.getBoundingClientRect(),l=parseInt(h.paddingTop),m=parseInt(h.paddingRight),p=parseInt(h.paddingBottom),r=parseInt(h.paddingLeft),s=parseInt(h.borderTopWidth),t=parseInt(h.borderRightWidth),u=parseInt(h.borderBottomWidth),v=parseInt(h.borderTopWidth),w=parseInt(h.marginTop),x=parseInt(h.marginRight),y=parseInt(h.marginBottom),z=parseInt(h.marginLeft),A=window.isRtl?"right":"left",B=r+v+z;let C={display:h.display,lineHeight:h.lineHeight,fontFamily:h.fontFamily,fontWeight:h.fontWeight,fontSize:h.fontSize,letterSpacing:h.letterSpacing,marginTop:`${w}px`,marginBottom:`${y}px`,paddingTop:`${l}px`,paddingBottom:`${p}px`,border:`0 solid transparent`,borderTopWidth:`${s}px`,borderBottomWidth:`${u}px`},D=0,E=0,F=0,G=0,H=0;if(f&&(Object.assign(c.style,C,{maxWidth:"initial"}),H=c.getBoundingClientRect().width,F+=B),g){Object.assign(b.style,C,{maxWidth:"initial"});const c=document.getElementById(`tsf-title-offset_${a.target.id}`);c.textContent=e,Object.assign(c.style,{fontFamily:C.fontFamily,fontWeight:C.fontWeight,fontSize:C.fontSize,letterSpacing:C.letterSpacing});const d=c.getBoundingClientRect().width,f=b.getBoundingClientRect().width;switch(q(a.target.id,"additionPlacement")){case"before":D=i.width-(m+t+x)-r-v-d-H,0>D&&(H+=D,D=0),D=D<f?D:f,0>D&&(D=0),G+=D,F+=D,E+=B;break;case"after":D=i.width-B-m-t-d-H,0>D&&(H+=D,D=0),D=D<f?D:f,0>D&&(D=0),E+=B+d+H;}}H=0>H?0:H,f&&(Object.assign(c.style,{[A]:`${F}px`,maxWidth:`${H}px`}),G+=H),g&&Object.assign(b.style,{[A]:`${E}px`,maxWidth:`${D}px`}),d.style.textIndent=`${G}px`},y=a=>{a.target.placeholder=s(a.target.id)[0].textContent},z=a=>{if("tsfC"in window){let b=document.getElementById(`${a.target.id}_chars`),c=s(a.target.id)[0];b&&tsfC.updateCharacterCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},A=a=>{if("tsfC"in window){let b=document.getElementById(`${a.target.id}_pixels`),c=s(a.target.id)[0];b&&tsfC.updatePixelCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},B=a=>{if(a){let b=p(a);b&&b.dispatchEvent(new Event("input"))}else f.forEach(a=>a.id&&B(a.id))},C=a=>{if(a){let b=p(a);b&&b.dispatchEvent(new CustomEvent("tsf-update-title-counter"))}else f.forEach(a=>a.id&&C(a.id))},D=a=>{x(a),u(a),y(a),E(a)},E=a=>{z(a),A(a)};let F={};const G=a=>{a in F&&clearTimeout(F[a]),F[a]=setTimeout(()=>B(a),1e3/60)},H=a=>{if("tsfAys"in window){let b=tsfAys.areSettingsChanged();B(a),!b&&tsfAys.areSettingsChanged()&&tsfAys.reset()}else B(a)};let I={};const J=a=>{a in I&&clearTimeout(I[a]),I[a]=setTimeout(()=>H(a),1e3/60)},K=a=>{let b=document.getElementById(a.target.dataset.for);if(b){let c=a.target.classList.contains("tsf-title-placeholder-additions")?"additions":"prefix",d=b.value;switch(b.focus(),a.detail){case 3:b.setSelectionRange(0,d.length);break;case 2:let e,f;"additions"===c&&"after"===q(b.id,"additionPlacement")||"prefix"===c&&window.isRtl?(e=d.replace(/(\w+|\s+)$/u,"").length,f=d.length):(e=0,f=d.length-d.replace(/^(\s+|\w+)/u,"").length),b.setSelectionRange(e,f);break;case 1:default:let g="additions"===c&&"after"===q(b.id,"additionPlacement")?d.length:0;b.setSelectionRange(g,g);}}},L=a=>a.preventDefault();let M=window.innerWidth;const N=()=>{let a=window.innerWidth;M<a?782>=M&&782<=a&&H():782<=M&&782>=a&&H(),M=a},O=()=>{window.addEventListener("tsf-resize",N),window.addEventListener("tsf-counter-updated",()=>J())},P=a=>{if(!(!a instanceof Element)){a.addEventListener("input",D),a.addEventListener("tsf-update-title-counter",E);let b=n(a.id),c=o(a.id);b.addEventListener("click",K),c.addEventListener("click",K),b.addEventListener("mousedown",L),c.addEventListener("mousedown",L),v(a.id),w(a.id),J(a.id)}};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",O)}},{setInputElement:b=>(f.set(b.id,b),g[b.id]={showPrefix:!0,allowReferenceChange:!0,defaultTitle:"",separator:a.states.titleSeparator,prefixPlacement:a.states.prefixPlacement},P(b),p(b.id)),getInputElement:p,getStateOf:q,updateStateOf:r,updateStateAll:(a,b,c)=>{c=Array.isArray(c)?c:[c],f.forEach(d=>{c.includes(d.id)||r(d.id,a,b)})},triggerCounter:C,triggerInput:B,enqueueTriggerInput:G,triggerUnregisteredInput:H,enqueueUnregisteredInputTrigger:J},{l10n:a,untitledTitle:b,privatePrefix:d,protectedPrefix:c,stripTitleTags:e})}(),window.tsfTitle.load();
