!function(a){window.GFCSAdmin={getDefaultInputs:function(e){for(var t=a.extend(!0,[],gformChainedSelectData.defaultInputs),i=0;i<t.length;i++)t[i].id=e.id+"."+(i+1);return t},updateAlignment:function(e){var t=GetSelectedField();t.chainedSelectsAlignment=e,a("#field_"+t.id).find(".ginput_container").removeClass("horizontal vertical").addClass(e)}};var e={gform_unique_id:"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),field_id:null,form_id:null};function t(e){e.preventDefault()}function s(e,t){var i=a(e.settings.drop_element),r=a("#gfcs-sample");i.removeClass("gf-dragging"),t?(r.show(),i.show()):(r.hide(),i.hide())}function r(e){var t=plupload.formatSize(e.size).toUpperCase(),i=f(e),r=e.dateUploaded?e.dateUploaded:Math.round(Date.now()/1e3),s=e.isFromFilter?"":'<span class="gfcs-remove"><i class="gficon-subtract"></i></span>',a=e.isFromFilter?'<div class="gfcs-source-message gforms_help_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.importedFilterFile):"";return'\t\t\t<div id="{0}" class="{3}"> \t\t\t\t<span class="gfcs-file-icon"></span> {1} <span class="gfcs-file-size">{2}</span> <span class="gfcs-file-date"> | {4}</span> <b class="gfcs-file-percent"></b> \t\t\t\t<span class="gfcs-success"><i class="gficon-tick gf_valid"></i></span> \t\t\t\t{5} \t\t\t\t<span class="gfcs-processing"></span> \t\t\t</div> \t\t\t{6}'.format(e.id,e.name,t,i,function(e){var t=Date.now()/1e3-e,i={hours:{period:3600,label:{singular:"hour",plural:"hours"}},minutes:{period:60,label:{singular:"min",plural:"mins"}},seconds:{period:1,label:{singular:"sec",plural:"secs"}}};for(var r in i)if(i.hasOwnProperty(r)){var s=i[r],a=Math.round(t/s.period),n="";if("hours"==r&&24<=a)break;if("seconds"==r&&0==a)n="{0} {1} ago".format(1,s.label.singular);else if(0<a){var l=1<a?s.label.plural:s.label.singular;n="{0} {1} ago".format(a,l);break}}if(!n){var o=new Date(1e3*e).toDateString().split(" ");n="{0} {1}, {2}".format(o[1],o[2],o[3])}return n}(r),s,a)}function n(e,t){var i=a(e.settings.progress);t?i.html(r(t)):i.html("")}function l(e){for(var t=a("#field_"+e.id+" .ginput_container"),i="",r=0;r<e.inputs.length;r++){i+='<span><select disabled="disabled">'+("<option>"+e.inputs[r].label+"</option>")+"</select></span>\n"}t.html(i)}function o(e){var t=GetSelectedField();return t&&(void 0===e.field||e.field.id==t.id)}function d(e){e.stop(),e.refresh(),e.start()}function c(e){e.files.splice(0,e.files.length),e.refresh(),e.start();var t=GetFieldById(e.field.id);t.choices=gformChainedSelectData.defaultChoices,t.inputs=i(t),t.gfcsFile=null,l(t),n(e,!1),s(e,!0)}function i(e){for(var t=a.extend(!0,[],gformChainedSelectData.defaultInputs),i=0;i<t.length;i++)t[i].id=e.id+"."+(i+1);return t}function f(e){return"gfcs-status-{0}".format(function(e){var t="";t=e.status&&e.status==plupload.UPLOADING?100==e.percent?"processing":"uploading":"complete";return t}(e))}function g(e,t){delete window.gfcsErrorTimeout,a("#gfcs-error").remove();var i=a('<div id="gfcs-error" class="error" style="width:375px;padding:1px 12px;"><p>{0}</p></div>'.format(t));a(e.settings.progress).html(i),window.gfcsErrorTimeout=setTimeout(function(){i.slideUp(function(){i.remove()})},1e4)}e["_gform_file_upload_nonce_{0}".format(form.id)]=window.gform_chainedselects_file_upload_nonce,new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:document.getElementById("pickfiles"),container:document.getElementById("gfcs-container"),progress:document.getElementById("gfcs-progress"),drop_element:document.getElementById("gfcs-drop"),dragdrop:!0,url:gformChainedSelectData.fileUploadUrl,filters:{max_file_size:parseInt(gformChainedSelectData.maxFileSize)/1e6+"mb",mime_types:[{title:"",extensions:"csv"}]},flash_swf_url:"/plupload/js/Moxie.swf",silverlight_xap_url:"/plupload/js/Moxie.xap",multipart_params:e,init:{PostInit:function(r){a(document).bind("gform_load_field_settings",function(e,t,i){if(o(r)||d(r),"chainedselect"==t.type){if(t.gfcsFilterEnabled&&!t.gfcsFile)return a(r.settings.progress).html('<div class="gfcs-source-message gforms_red_alert"><i class="fa fa-warning"></i> {0}</div>'.format(gformChainedSelectData.strings.errorImportingFilterFile)),void s(r,!1);r.field=a.extend({},t),document.getElementById("gfcs-progress").innerHTML="",t.gfcsFile?(n(r,t.gfcsFile),s(r,!1)):c(r)}}),a(r.settings.drop_element).on("dragover",function(){a(this).addClass("gf-dragging")}).on("dragleave",function(){a(this).removeClass("gf-dragging")}),a(r.settings.drop_element).on({dragenter:t,dragover:t}),a(r.settings.progress).on("click","span.gfcs-remove",function(){r.field.gfcsFilterEnabled||c(r)}),gform.addFilter("gform_duplicate_field_chainedselect",function(e){return e.gfcsFilterEnabled&&(e.gfcsFile=null,e.gfcsFilterEnabled=!1,e.choices=gformChainedSelectData.defaultChoices,e.inputs=i(e)),e})},FilesAdded:function(r,e){s(r,!1);var t=1<r.files.length;if(e=r.files,t){var i=e.length-1;a.each(e,function(e,t){e<i&&r.removeFile(t)})}a.each(e,function(e,t){if(t.status!=plupload.FAILED){n(r,t),a("#"+t.id).attr("class",f(t));var i=r.getOption("multipart_params");i.field_id=field.id,i.form_id=form.id,i.original_filename=t.name,r.setOption("multipart_params",i)}else r.removeFile(t)}),r.refresh(),r.start()},UploadProgress:function(e,t){o(e)?(document.getElementById(t.id).getElementsByTagName("b")[0].innerHTML="<span>"+t.percent+"%</span>",a("#"+t.id).attr("class",f(t))):d(e)},Error:function(e,t){c(e);var i=t.message;-601==t.code?i=gformChainedSelectData.strings.errorFileType:-600==t.code&&(i=gformChainedSelectData.strings.errorFileSize),g(e,gformChainedSelectData.strings.errorUploadingFile+"<br>Error: "+t.code+", Message: "+i)},FileUploaded:function(e,t,i){var r;try{r=a.secureEvalJSON(i.response)}catch(e){r={status:"error",error:{message:!1}}}if("error"==r.status)return c(e),void g(e,gformChainedSelectData.strings.errorProcessingFile+"<br>Error: "+r.error.code+", Message: "+r.error.message);if(100==t.percent&&r.status&&"ok"==r.status){var s=GetSelectedField();s.choices=r.data.choices,s.inputs=r.data.inputs,s.gfcsFile={name:t.name,type:t.type,size:t.size,dateUploaded:Math.round((new Date).getTime()/1e3),isFromFilter:!1},l(s),a("#"+t.id).attr("class",f(t))}}}}).init()}(jQuery);